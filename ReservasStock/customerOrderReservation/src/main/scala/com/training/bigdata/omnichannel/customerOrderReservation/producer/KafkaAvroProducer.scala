package com.training.bigdata.omnichannel.customerOrderReservation.producer

import java.util.{Properties, UUID}

import com.training.bigdata.omnichannel.customerOrderReservation.events.CustomerOrderReservationEvent.{Events, Order}
import com.training.bigdata.omnichannel.customerOrderReservation.events.avro.BeanToRecordConverter
import com.training.bigdata.omnichannel.customerOrderReservation.events.avro.AvroInterpreter._
import org.apache.avro.Schema
import org.apache.avro.generic.GenericRecord
import com.training.bigdata.omnichannel.customerOrderReservation.utils.PropertiesUtil
import com.training.bigdata.omnichannel.customerOrderReservation.utils.log.FunctionalLogger
import io.confluent.kafka.serializers.{AbstractKafkaAvroSerDeConfig, KafkaAvroSerializer}
import org.apache.kafka.clients.CommonClientConfigs
import org.apache.kafka.clients.producer.{Callback, KafkaProducer, ProducerConfig, ProducerRecord, RecordMetadata}
import org.apache.kafka.common.config.SaslConfigs
import org.apache.kafka.common.protocol.SecurityProtocol
import org.apache.kafka.common.serialization._
import io.circe.generic.auto._
import io.circe.parser

import scala.io.Source
import scala.util.Random


object KafkaAvroProducer extends FunctionalLogger {

  private val defaultOrderJson: String = "{\"shippingGroups\": [{\"daysToDeliver\": \"qqabxerjajlcufurimasmekjy\", \"shippingMethod\": \"yupixlsydsvlpfgpul\", \"shippingGroupId\": \"rnpiiokpkhxonis\", \"rawShipping\": null, \"clientCourierId\": null, \"shippingGroupType\": \"jfkelckhlcjbtteabqpgtoarrvnuwlkkquywgv\", \"glcreceivedDate\": \"btskbcgbvvtfshpcmnstksjabkyvky\", \"state\": \"aqrdvhpxdbcpdfwsvlnjgawrxuvbnfton\", \"glcorderNumber\": \"endqeprakrjytjicojfoyipqjpphhmtdnd\", \"pickingDate\": null, \"clickCollect\": {\"storeName\": \"qoiwnx\", \"storeId\": null, \"rpmorderNumber\": \"evludntiyvjtdxfmnnxcdrgqtfcl\"}, \"deliveryInformation\": {\"originalDeliveryDate\": null, \"deliveryDate\": null, \"deliveryFromHour\": \"xdbfcctnhhifacsuiupjfdijfpot\", \"deliverytoHour\": null, \"deliveryTimeSlotId\": \"bmrs\"}, \"logisticFood\": null, \"address\": {\"country\": \"ybcmdguqowrntdidkyvnwtruajv\", \"surname\": \"ndptmchtbdqghmhreljabgajv\", \"name\": null, \"phoneNumber\": null, \"block\": \"teeblgcxdqwwvnwrnkuvibtsqlwuvqpeamcp\", \"floor\": null, \"door\": \"nmdqfdxt\", \"province\": \"epfqlgap\", \"city\": \"aldaasggjymnl\", \"streetName\": \"pes\", \"streetNumber\": \"whfjkpmgciibycealdnlcsfgmqjb\", \"streetType\": null, \"stair\": null, \"neighborhood\": \"pirxqincgiitumsyoupkc\", \"zipCode\": null, \"transporterInfo\": \"qksqkakjnsqxxgk\", \"censusTract\": \"lkyitntripojjaytwyrn\", \"coordX\": \"uddbibhvevohqwjfxaewujmqdcr\", \"coordY\": \"kqyxjprfnbnvxepg\", \"reliabilityIndex\": null, \"normalizationStatus\": true}, \"shippingPriceInfo\": {\"amount\": 0.7449931132479373, \"coste1Type\": \"\", \"coste1\": 0.9244918748084867, \"totalAdjustment\": null, \"amountNoDiscounts\": 0.2477998729548312, \"adjustments\": []}}, {\"daysToDeliver\": \"bdmxbkbxvkbuqcmekvivihbomgj\", \"shippingMethod\": \"\", \"shippingGroupId\": \"rudnsnqailcugaitdxmhpatlqhwcbrvquqwkw\", \"rawShipping\": null, \"clientCourierId\": null, \"shippingGroupType\": null, \"glcreceivedDate\": null, \"state\": \"dxwfvkufytdxrrsttahecvmravlcyjgjfs\", \"glcorderNumber\": \"go\", \"pickingDate\": \"ruefxmnq\", \"clickCollect\": null, \"deliveryInformation\": {\"originalDeliveryDate\": \"ceelwuoybwvcgqhkslqbeenvvulicaxtijpbqht\", \"deliveryDate\": null, \"deliveryFromHour\": null, \"deliverytoHour\": null, \"deliveryTimeSlotId\": \"ycucifdphoijvmdmxerxmyab\"}, \"logisticFood\": {\"salePointName\": null, \"salePointId\": \"kthfhslggdibkwxsvnsspqkxvgswwsf\", \"regionDesc\": null, \"regionId\": null, \"zoneDesc\": \"riflskfmilggirso\", \"subzoneDesc\": null, \"subzoneCode\": null, \"zoneId\": \"cekdux\", \"routeId\": null}, \"address\": {\"country\": null, \"surname\": null, \"name\": null, \"phoneNumber\": \"k\", \"block\": null, \"floor\": \"ylsvjqohv\", \"door\": \"bydnrruyakjiykgjb\", \"province\": null, \"city\": \"poxohagcrnpgjhtm\", \"streetName\": null, \"streetNumber\": \"adsdjjhuwhbckn\", \"streetType\": \"lyqppcqfybtumlfbsgnhxldehiihbdvjjid\", \"stair\": null, \"neighborhood\": \"tyhpyawlcihpvlbrpnfkdrmorgtynmlurlm\", \"zipCode\": \"b\", \"transporterInfo\": \"nydlbysiq\", \"censusTract\": \"ettcdgrlugpiwwvnkpuovvnjvfwubuubvobppa\", \"coordX\": \"xomiejgvqgvrnjvpnrjdengsjryemkqwjcaypng\", \"coordY\": null, \"reliabilityIndex\": null, \"normalizationStatus\": false}, \"shippingPriceInfo\": {\"amount\": 0.45614492059485356, \"coste1Type\": \"xeiukckkdlvkt\", \"coste1\": null, \"totalAdjustment\": null, \"amountNoDiscounts\": null, \"adjustments\": null}}, {\"daysToDeliver\": null, \"shippingMethod\": \"rqgfdjdkxydtgjpwteaifovvoepkayh\", \"shippingGroupId\": \"jmwu\", \"rawShipping\": null, \"clientCourierId\": null, \"shippingGroupType\": \"ssiqmff\", \"glcreceivedDate\": null, \"state\": \"glwrbchaulp\", \"glcorderNumber\": null, \"pickingDate\": null, \"clickCollect\": null, \"deliveryInformation\": {\"originalDeliveryDate\": null, \"deliveryDate\": null, \"deliveryFromHour\": \"lfplwuri\", \"deliverytoHour\": null, \"deliveryTimeSlotId\": null}, \"logisticFood\": {\"salePointName\": null, \"salePointId\": null, \"regionDesc\": null, \"regionId\": \"ayjboxtacsgtujoglrftrmqljhkaewtbomkydiv\", \"zoneDesc\": null, \"subzoneDesc\": \"qafohpjfbyphehykmcvtcfosilhtqfttfkn\", \"subzoneCode\": null, \"zoneId\": \"mvhqq\", \"routeId\": \"khhsaj\"}, \"address\": {\"country\": \"mqfxsfaraswrhnqltjjfdapsxahp\", \"surname\": null, \"name\": null, \"phoneNumber\": null, \"block\": \"tpquqpynknygtmwmmuxprqeowfojoldydbvev\", \"floor\": null, \"door\": \"kwbtdceyudfywvdgnrwqcmj\", \"province\": null, \"city\": \"hnvltpjqewkdxaigwhbluismo\", \"streetName\": null, \"streetNumber\": null, \"streetType\": \"qgplucdwvkyeepx\", \"stair\": \"piylirajejrdohmn\", \"neighborhood\": \"xojhfmivxfdwjkbqrixsckixwfpiiksoksi\", \"zipCode\": \"odoeymqwjiwgyprpvadlahrwnmrdvk\", \"transporterInfo\": \"yvlcbhgfctgubtvnwxoqcsailgo\", \"censusTract\": \"agdlvhpaufoddr\", \"coordX\": null, \"coordY\": \"jpgtyf\", \"reliabilityIndex\": \"wirtunecnhgegeqkoqkxgvixhwiw\", \"normalizationStatus\": null}, \"shippingPriceInfo\": {\"amount\": 0.6026762622469874, \"coste1Type\": \"dfhqhrntsdpewtrrwoycoa\", \"coste1\": null, \"totalAdjustment\": null, \"amountNoDiscounts\": 0.29378969603200344, \"adjustments\": null}}, {\"daysToDeliver\": \"iccohpbwauuec\", \"shippingMethod\": \"cgqeburhdqmacwhikeugvjeysglwoufiujnmbh\", \"shippingGroupId\": \"veumsdcvqh\", \"rawShipping\": null, \"clientCourierId\": null, \"shippingGroupType\": \"lfcd\", \"glcreceivedDate\": \"lmqccisgqvdpccwqcjeaojtkubkdouggofdhdil\", \"state\": \"suxiogj\", \"glcorderNumber\": null, \"pickingDate\": \"oduqvxcupjpylsvc\", \"clickCollect\": {\"storeName\": \"wgnlankydlfblhpbknpep\", \"storeId\": null, \"rpmorderNumber\": null}, \"deliveryInformation\": null, \"logisticFood\": {\"salePointName\": \"gimvupuokehpb\", \"salePointId\": null, \"regionDesc\": null, \"regionId\": \"fptkmh\", \"zoneDesc\": \"ejudcfbiqdxeioslugeaxnuy\", \"subzoneDesc\": \"tq\", \"subzoneCode\": null, \"zoneId\": \"ofhvddasceorwhmvxq\", \"routeId\": null}, \"address\": {\"country\": \"ufoibkfcxyboxkqtvwbfkckxftbt\", \"surname\": \"edwspgbwimrynllqxdterroqclk\", \"name\": null, \"phoneNumber\": \"pmwapdqiacavpucfw\", \"block\": null, \"floor\": \"kmkjfstvfcfebajwwisvrckjq\", \"door\": \"eu\", \"province\": null, \"city\": \"rlbkitnsdcbgrbamrqabqbcgr\", \"streetName\": \"qidselghmbsiksusmuh\", \"streetNumber\": null, \"streetType\": null, \"stair\": null, \"neighborhood\": null, \"zipCode\": null, \"transporterInfo\": null, \"censusTract\": \"kwpbbsldsuj\", \"coordX\": null, \"coordY\": \"jbvomwwouxyhwwbpakqk\", \"reliabilityIndex\": \"cgxrkxwmewngyqosmqcqpjhvmyjhmrudjk\", \"normalizationStatus\": false}, \"shippingPriceInfo\": {\"amount\": 0.06754618711086136, \"coste1Type\": null, \"coste1\": 0.7701101937228608, \"totalAdjustment\": null, \"amountNoDiscounts\": null, \"adjustments\": null}}, {\"daysToDeliver\": null, \"shippingMethod\": \"jywwefadcfxtapdodhfy\", \"shippingGroupId\": \"afoaklo\", \"rawShipping\": 0.1898508759494013, \"clientCourierId\": null, \"shippingGroupType\": null, \"glcreceivedDate\": \"mllxdhmweoegdafkwjfsnwfngvrefftfaksae\", \"state\": \"taeuwacrv\", \"glcorderNumber\": \"cnfwhnolmtyvlykgl\", \"pickingDate\": null, \"clickCollect\": null, \"deliveryInformation\": null, \"logisticFood\": null, \"address\": {\"country\": \"vlellhhxypymytgukuxabmyjntsicve\", \"surname\": null, \"name\": \"j\", \"phoneNumber\": null, \"block\": \"ehtmw\", \"floor\": \"\", \"door\": null, \"province\": \"flxmcsrevnohxyjyrfcpmsyjgvewcnoumwal\", \"city\": \"omxbjabxejvvlauvexnrhuypcqcirdfh\", \"streetName\": null, \"streetNumber\": null, \"streetType\": \"ofvjlslykhrkb\", \"stair\": \"fvfeieilhgljjad\", \"neighborhood\": \"fnsey\", \"zipCode\": null, \"transporterInfo\": \"aetfigueqlwqdlxoofuergnfdggj\", \"censusTract\": null, \"coordX\": \"vvtyuxvedmwluhodjfbm\", \"coordY\": null, \"reliabilityIndex\": null, \"normalizationStatus\": false}, \"shippingPriceInfo\": {\"amount\": 0.0010144621468612947, \"coste1Type\": \"rtxjvqtcacigqoihawsavde\", \"coste1\": null, \"totalAdjustment\": null, \"amountNoDiscounts\": 0.4242866369190379, \"adjustments\": [{\"id\": \"tgcmbbndeppvltwldkxq\", \"adjustmentType\": \"\", \"promotionType\": null, \"amount\": 0.47895701123879586, \"dofoCode\": \"ehtwjmhhacpxeacotspiwjsgertjsvs\", \"description\": \"tqplcrnakacovearormxojffpkxvhn\", \"promoId\": \"eskfyjgcdtxidsrsptcjmo\", \"couponDesc\": \"vjstnyvrbraceraultnj\", \"couponId\": \"qpnigjkwtpurafctjvvluwuwohhg\", \"applicableSite\": null, \"generatedCoupon\": null, \"accumulationDate\": \"qxtirq\", \"employeeDiscountPercent\": 0.10068768209760537, \"endRedentionDate\": \"agbljvkvht\", \"accumulatedAmount\": null, \"spentAmount\": null, \"customerId\": \"djxlvftcofpavtjihjtmvtbjojbeomjaip\", \"name\": null, \"sequencial\": \"falkhfrdaobtul\", \"taxRecovery\": true, \"provision\": null, \"redemptionRatio\": null, \"applicationScope\": null}]}}], \"commerceItems\": [{\"paymentGroupId\": \"jddbxribsfpqfsyhooppsuhosllfgkbtmpqwftt\", \"color\": \"jlhbuggwukrxwuvgockwbatk\", \"quantity\": 139499146, \"productId\": \"itefgawyr\", \"shippingGroupId\": \"iaebejlovcgdkjuyroavpgvayafoxqi\", \"skuId\": \"ibjpcbytmfqhsrqbaubudpactlrqup\", \"ean13\": \"tnqjukmx\", \"smsSizeColor\": null, \"providerLdp\": null, \"manufacturerCode\": \"oqnanritsobdmnoqkgdhcaxjcbmcpergxsaiuoi\", \"legalAdvertisementAcCheck\": null, \"name\": \"musppeympchtcedjnbxnq\", \"size\": \"nbguj\", \"quantityDelivered\": 791900261, \"grossWeight\": null, \"weight\": null, \"variableWeight\": null, \"smsId\": null, \"unitOfMeasure\": \"iumoidngftjeuoiiccvjacjkonhipcaqocvs\", \"typeOfCut\": null, \"missed\": null, \"substitute\": null, \"itemReplace\": \"or\", \"foodLine\": null, \"marketplace\": null, \"locationId\": null, \"webDescription\": \"afghaxudqxmbevvwedwgntfpdkkkp\", \"brand\": \"yxgueiflfilaoupea\", \"container\": null, \"section\": null, \"family\": null, \"subfamily\": null, \"volumetry\": {\"width\": null, \"high\": null, \"weight\": null, \"length\": 0.3828359406369847}, \"commerceItemPriceInfo\": {\"amountNoDiscounts\": 0.8497888441701159, \"iva\": 0.6249785654202477, \"ruleId\": \"vmgwqwlgjjwxbrdmryvsemckniicibuoqew\", \"costPrice\": 0.5954327235157122, \"totalAdjustment\": 0.5758215309998259, \"sellerId\": \"cyw\", \"sellerName\": \"kdmv\", \"amount\": 0.13320463165790675, \"salePrice\": 0.9112048476032167, \"listPrice\": 0.4931675537952305, \"incentive\": \"xsfnvjciciigkoxo\", \"adjustments\": []}}, {\"paymentGroupId\": null, \"color\": null, \"quantity\": -1328842005, \"productId\": \"riwgjjwpmqxhgessovsbetrufykeewoqm\", \"shippingGroupId\": null, \"skuId\": \"pnfolawvghelwinwvx\", \"ean13\": \"jihqhbdqmptyewtnrbti\", \"smsSizeColor\": \"mrvdbircgtfrqhceutsoqcwmmgor\", \"providerLdp\": \"qhxlkjlr\", \"manufacturerCode\": null, \"legalAdvertisementAcCheck\": null, \"name\": \"oaunakcdnnlvecdotvikw\", \"size\": \"gbwjgpcftyvakudtmyvyqiiesqumiolkra\", \"quantityDelivered\": 855135892, \"grossWeight\": 0.7664669681766183, \"weight\": null, \"variableWeight\": null, \"smsId\": null, \"unitOfMeasure\": \"\", \"typeOfCut\": null, \"missed\": null, \"substitute\": null, \"itemReplace\": \"qxicbkytsadwfkriibnlycdtpufft\", \"foodLine\": \"jw\", \"marketplace\": true, \"locationId\": \"gjtnrcsojjnkixghvrkgdffhlpj\", \"webDescription\": null, \"brand\": null, \"container\": null, \"section\": \"kybdggkbvcdfuxdlsqdigtorabssgq\", \"family\": null, \"subfamily\": null, \"volumetry\": {\"width\": 0.9684906838213895, \"high\": null, \"weight\": 0.156170945365391, \"length\": 0.43044569881816386}, \"commerceItemPriceInfo\": {\"amountNoDiscounts\": null, \"iva\": 0.5355647353480013, \"ruleId\": null, \"costPrice\": null, \"totalAdjustment\": 0.7567055314689946, \"sellerId\": null, \"sellerName\": null, \"amount\": 0.1513556977614039, \"salePrice\": 0.18093031149818362, \"listPrice\": 0.15842535363691412, \"incentive\": null, \"adjustments\": null}}, {\"paymentGroupId\": \"fagmmbht\", \"color\": \"vewfpgsoqa\", \"quantity\": 1504742140, \"productId\": \"qyqbubunejiktiqkogxkegpddr\", \"shippingGroupId\": \"ve\", \"skuId\": \"mvrgaeeutvyqjhcrtkadgrxtyhhk\", \"ean13\": \"ucagvpdsyfjem\", \"smsSizeColor\": \"gwfoqiohipfvaywuisyskeerovkyxx\", \"providerLdp\": null, \"manufacturerCode\": null, \"legalAdvertisementAcCheck\": true, \"name\": \"rdloyypdjfpkbgdvh\", \"size\": \"euelswlmfgkqquxkwctymyrdtgiqutudgbu\", \"quantityDelivered\": null, \"grossWeight\": 0.7700385975806521, \"weight\": 0.38351957129820813, \"variableWeight\": false, \"smsId\": \"dssxowmancxmbkwto\", \"unitOfMeasure\": \"kfswrxkpdg\", \"typeOfCut\": null, \"missed\": false, \"substitute\": null, \"itemReplace\": \"nrxdkpbusdueuahkrpahcnqsymch\", \"foodLine\": \"ciobsg\", \"marketplace\": false, \"locationId\": null, \"webDescription\": null, \"brand\": \"b\", \"container\": \"wcmncunyoxkaoml\", \"section\": \"uywlpmgxyvovyvtvmdxmhawxghcgnlllsdu\", \"family\": \"mrmebncxvsjpucqvaq\", \"subfamily\": \"omlfhjdmhxfgkamynrbqnhetjmjndv\", \"volumetry\": {\"width\": 0.748477192611689, \"high\": null, \"weight\": null, \"length\": 0.29093044357677145}, \"commerceItemPriceInfo\": {\"amountNoDiscounts\": 0.14982392765546415, \"iva\": 0.9318494253129102, \"ruleId\": \"wbbhovoilovqkiuqgtpkjjgusfpoftvhtidvj\", \"costPrice\": null, \"totalAdjustment\": null, \"sellerId\": \"rcmwhgopikaeccbc\", \"sellerName\": null, \"amount\": 0.6945168201063, \"salePrice\": 0.9435836313055173, \"listPrice\": 0.13833225843530172, \"incentive\": null, \"adjustments\": [{\"id\": \"yvsuudysnhytismkreihyocukpgxakxxeerrp\", \"adjustmentType\": \"otsunahilocovsmmavbvlsgymhrd\", \"promotionType\": \"jotqxlwkgrupscfugwtuessufgttqipdhaabik\", \"amount\": null, \"dofoCode\": \"lpydwhpydqvnrhhgtls\", \"description\": \"br\", \"promoId\": null, \"couponDesc\": \"khgbxdxyncygfnqlfjvhwtk\", \"couponId\": \"ifogyitghndsesytfcp\", \"applicableSite\": null, \"generatedCoupon\": \"xnuudpficqlnjehfooxjayypdcvuf\", \"accumulationDate\": null, \"employeeDiscountPercent\": 0.6090241197476288, \"endRedentionDate\": null, \"accumulatedAmount\": 0.45028181487933694, \"spentAmount\": 0.8156303651543952, \"customerId\": null, \"name\": \"nfcwdhhwhjcfsiiimhqsybytslhatehbfxxoxyp\", \"sequencial\": \"syncvccvepbmkadhlfimabtcg\", \"taxRecovery\": true, \"provision\": 0.21481997401937758, \"redemptionRatio\": null, \"applicationScope\": null}, {\"id\": \"xvbfghtkidpm\", \"adjustmentType\": \"mkwpggxfchtuafqflxyunruiewfxwfn\", \"promotionType\": \"hhxdhjiitf\", \"amount\": 0.30520028170701263, \"dofoCode\": null, \"description\": \"moluxlgmwsumegddtrhgbyhmgopyssjqm\", \"promoId\": \"mbsqjhlulswmkejwr\", \"couponDesc\": \"vfbjhbufovimlnomdnboidkniy\", \"couponId\": \"noolqsrwxxlpmfbjnwjeuwmrywlnflhouqjo\", \"applicableSite\": \"doidflaxu\", \"generatedCoupon\": null, \"accumulationDate\": \"xeqivrqxpwgofx\", \"employeeDiscountPercent\": 0.17628713767564153, \"endRedentionDate\": \"ifbqtbrbdilaelmvfadikskycfejy\", \"accumulatedAmount\": null, \"spentAmount\": 0.39428055328572387, \"customerId\": null, \"name\": \"cbfoakudtydepiinbhnk\", \"sequencial\": \"tatfnhpvqkvlvygd\", \"taxRecovery\": true, \"provision\": 0.4559112464304058, \"redemptionRatio\": null, \"applicationScope\": \"hucggupxybkfkcr\"}]}}, {\"paymentGroupId\": null, \"color\": \"ipxuugaqaikrvqkibnuyqhvyywrurprcknuvh\", \"quantity\": -191984502, \"productId\": \"glfxubsltgbfxdgm\", \"shippingGroupId\": null, \"skuId\": \"cvdtdvqjacqieiwqsqilddo\", \"ean13\": \"isfnbqlag\", \"smsSizeColor\": \"aqly\", \"providerLdp\": null, \"manufacturerCode\": \"auwvrmnobwlubstpwri\", \"legalAdvertisementAcCheck\": null, \"name\": \"hsnbwgsmitxypxmmykukfkfupbxr\", \"size\": null, \"quantityDelivered\": null, \"grossWeight\": 0.9428884057251635, \"weight\": null, \"variableWeight\": null, \"smsId\": null, \"unitOfMeasure\": \"ddtuimyuphpkcwtgc\", \"typeOfCut\": null, \"missed\": true, \"substitute\": null, \"itemReplace\": null, \"foodLine\": \"xhckfiuidcrbiaojigdgiufiysmvxcutg\", \"marketplace\": null, \"locationId\": null, \"webDescription\": \"dgyqkjijinfdvqulsssacum\", \"brand\": \"lb\", \"container\": null, \"section\": null, \"family\": \"crkcsmuppftnmpfdhwdcsgok\", \"subfamily\": \"geonguiciqnqgemuyisqsphixfybgjcof\", \"volumetry\": {\"width\": null, \"high\": 0.5374322681335343, \"weight\": null, \"length\": 0.5936519756942785}, \"commerceItemPriceInfo\": {\"amountNoDiscounts\": null, \"iva\": 0.1806557908789187, \"ruleId\": null, \"costPrice\": 0.5982229387190378, \"totalAdjustment\": null, \"sellerId\": \"prrivuhyfrtjckdnnnlyxpwblgylgj\", \"sellerName\": null, \"amount\": 0.04954214812952229, \"salePrice\": 0.8447764545060759, \"listPrice\": 0.30322264109618324, \"incentive\": null, \"adjustments\": null}}], \"paymentGroups\": [{\"alias\": \"wbxwylqydxbugqnmpqgxu\", \"paymentGroupId\": \"mwiehvramcuqy\", \"omsOrderId\": \"iwkkorijibaxowsiqudaqymawapoqkjvkyffc\", \"creditCardType\": null, \"amount\": 0.23026309987228732, \"paymentMethod\": \"oraelqtffmpswcbq\", \"docIdType\": null, \"docId\": \"lmidsutavi\", \"paymentStatus\": null, \"creditCardLastDigits\": \"hsgooyv\", \"descriptiveCreditCardType\": null, \"paymentGroupType\": \"axmmygfl\", \"payId\": \"xplkpdpthpvpexmst\", \"pspId\": \"wj\", \"authorizationStatus\": \"aotbxtlftnrsth\", \"paymentDate\": \"qsdvonbdixhyfuwktfrrtthxlgdnjtkvpc\", \"address\": {\"country\": \"smxdeqbchxhkovhixmurmu\", \"surname\": \"glcobjlyoqmhpraeebvmoubmxgylaacy\", \"name\": null, \"phoneNumber\": null, \"block\": null, \"floor\": \"klsmdgogotcmb\", \"door\": \"dfjqufmppto\", \"province\": null, \"city\": \"fhtvmfkb\", \"streetName\": \"mcfa\", \"streetNumber\": null, \"streetType\": null, \"stair\": null, \"neighborhood\": \"rsedhpqimpjhoweanirwu\", \"zipCode\": null, \"transporterInfo\": null, \"censusTract\": \"cfbkhtxehpfvchpxbldpvpctgkrvwr\", \"coordX\": null, \"coordY\": null, \"reliabilityIndex\": null, \"normalizationStatus\": null}, \"securePayment\": null, \"funding\": {\"fundedAmount\": 0.1655314548301623, \"manageFee\": 0.8743321124381257, \"description\": \"ccdaynqkagaogsmaqiv\", \"TIN\": 0.13932432847875198, \"TAE\": null, \"incentiveFunding\": null, \"months\": null}}, {\"alias\": null, \"paymentGroupId\": \"rhruxcbvbqyesuhmuixbys\", \"omsOrderId\": \"hekytrnhxemmtkqkawuuutfgyonbcroasdq\", \"creditCardType\": \"ypwqjbxxjpggvdhprlqln\", \"amount\": 0.0749153048191219, \"paymentMethod\": null, \"docIdType\": null, \"docId\": \"kogk\", \"paymentStatus\": null, \"creditCardLastDigits\": null, \"descriptiveCreditCardType\": \"irn\", \"paymentGroupType\": \"ormbllwtenbspto\", \"payId\": \"gmdfyijnyujxlypulqddpiggiwtdmqxasgvsbjt\", \"pspId\": \"nkn\", \"authorizationStatus\": null, \"paymentDate\": null, \"address\": {\"country\": \"axtdusovvqsvkslrghsu\", \"surname\": null, \"name\": null, \"phoneNumber\": null, \"block\": null, \"floor\": null, \"door\": \"xxrhvtepxxca\", \"province\": null, \"city\": \"lmk\", \"streetName\": \"gnrski\", \"streetNumber\": \"hs\", \"streetType\": \"gqcosuhhsqldxcokakawhammrcchnuvwqj\", \"stair\": null, \"neighborhood\": null, \"zipCode\": null, \"transporterInfo\": \"dkeqqjotwjtqvcjnjkhambybxvdbbrwipqnnlmc\", \"censusTract\": \"wgnpuvcurkbcfglkybjwhgqpd\", \"coordX\": \"mfsisvuxihilyxtlhbovpywva\", \"coordY\": \"unajchplnskmdhnnvv\", \"reliabilityIndex\": null, \"normalizationStatus\": null}, \"securePayment\": null, \"funding\": {\"fundedAmount\": null, \"manageFee\": 0.9057034670060862, \"description\": null, \"TIN\": 0.03286764223831051, \"TAE\": 0.0699507612472422, \"incentiveFunding\": \"jetdiixtupipljorlpdowfspcoodsgwitxuwbd\", \"months\": 1987077198}}, {\"alias\": null, \"paymentGroupId\": \"drr\", \"omsOrderId\": null, \"creditCardType\": \"yyek\", \"amount\": 0.5682921117975136, \"paymentMethod\": \"yyfwjrytrjyxwkvbhucgxnefrmrnixx\", \"docIdType\": null, \"docId\": null, \"paymentStatus\": null, \"creditCardLastDigits\": \"b\", \"descriptiveCreditCardType\": null, \"paymentGroupType\": \"w\", \"payId\": \"nvdrwtsirvwlojbimhskfoaspcysflrhng\", \"pspId\": \"ma\", \"authorizationStatus\": null, \"paymentDate\": null, \"address\": {\"country\": \"gedfmuiirysknwqgtwinpfpitrbvb\", \"surname\": null, \"name\": \"jrptyhvesdmgbwowwcnqprwbjnnhgfegxkqilm\", \"phoneNumber\": null, \"block\": \"mirdwigyxolrnelerqvbslr\", \"floor\": null, \"door\": \"mvhivqhaxraecjybdltcxndns\", \"province\": \"xedxkanbokrjeecfduuypvgrdlwb\", \"city\": \"fisnlnlxx\", \"streetName\": null, \"streetNumber\": \"lilscgrbxljimfymtdvdsmwuoapo\", \"streetType\": \"jkv\", \"stair\": null, \"neighborhood\": null, \"zipCode\": \"hwpludnq\", \"transporterInfo\": \"chojtxoxda\", \"censusTract\": null, \"coordX\": \"mlqcbldrtewbayoefhm\", \"coordY\": \"plxcwtoxiuqrrwcbhxdfmttdeff\", \"reliabilityIndex\": null, \"normalizationStatus\": null}, \"securePayment\": null, \"funding\": null}, {\"alias\": null, \"paymentGroupId\": \"numrfjsilpwamcxouiovxkqlansomejuu\", \"omsOrderId\": null, \"creditCardType\": \"fio\", \"amount\": 0.026393597662992763, \"paymentMethod\": \"wg\", \"docIdType\": \"p\", \"docId\": null, \"paymentStatus\": null, \"creditCardLastDigits\": null, \"descriptiveCreditCardType\": null, \"paymentGroupType\": \"imr\", \"payId\": \"vqfbncdgutaddn\", \"pspId\": \"vqxiwhclasjmyunhqyiwprivveh\", \"authorizationStatus\": \"ycxrevbldec\", \"paymentDate\": \"pnsmdbstvdj\", \"address\": {\"country\": \"wxnpw\", \"surname\": \"ioihbaruwitwnbqwqooglfdmvt\", \"name\": null, \"phoneNumber\": null, \"block\": null, \"floor\": \"ijhwkfdrxlbmlguftdko\", \"door\": \"peslskfcotshjvmdfwgcdyopostgcqkskvk\", \"province\": \"rypglexkaomcapdcdgqnwieabmoc\", \"city\": \"tkof\", \"streetName\": null, \"streetNumber\": null, \"streetType\": null, \"stair\": \"xqogkuhxgninkcmbfwpqn\", \"neighborhood\": null, \"zipCode\": null, \"transporterInfo\": null, \"censusTract\": null, \"coordX\": null, \"coordY\": \"rof\", \"reliabilityIndex\": null, \"normalizationStatus\": null}, \"securePayment\": false, \"funding\": null}, {\"alias\": \"qfjlg\", \"paymentGroupId\": \"hijqi\", \"omsOrderId\": \"hkkvylbii\", \"creditCardType\": \"achvvnkpaalwqwrbihkwdtxmiaiugoqj\", \"amount\": 0.33709894754164293, \"paymentMethod\": null, \"docIdType\": null, \"docId\": null, \"paymentStatus\": null, \"creditCardLastDigits\": null, \"descriptiveCreditCardType\": null, \"paymentGroupType\": \"xynskkbofppvlgudgimrhrbntqjhtkpioa\", \"payId\": \"csidbvxdwt\", \"pspId\": \"lsyrseayrtndmphollirylgeasgaujqjlgpuudu\", \"authorizationStatus\": \"qfttkrlhxnirbkvxmymgprtfablvvdbcm\", \"paymentDate\": \"mnxoaxxiryqiwosolslihmjjecxxjea\", \"address\": {\"country\": null, \"surname\": \"wsrtsfjybxgn\", \"name\": null, \"phoneNumber\": \"swgenaaaqumtlrqadjkfyuxortsb\", \"block\": null, \"floor\": \"hpsqugp\", \"door\": \"rpavuisynhbcyaymultxwgij\", \"province\": null, \"city\": \"mxeeiudn\", \"streetName\": null, \"streetNumber\": null, \"streetType\": \"bnnwooopietkejuujeqckssvuxekowbnifbt\", \"stair\": null, \"neighborhood\": \"xoqcfcku\", \"zipCode\": \"hiybbrsvlkdamho\", \"transporterInfo\": null, \"censusTract\": \"bnwnpevcsppi\", \"coordX\": null, \"coordY\": null, \"reliabilityIndex\": \"eyqygksegguarkvgvdtjkkih\", \"normalizationStatus\": true}, \"securePayment\": true, \"funding\": null}], \"orderCustomerInfo\": {\"customerDoc\": \"gsu\", \"customerId\": \"evqfihqrcnlokvnhphhmayhscmjhrq\", \"customerName\": \"gy\", \"customerLastName\": \"iichfrgyvdekrlrpylcnuqiepp\", \"customerEmail\": \"avfrgpjbplhuvnsdibhfdutiobamqrsh\", \"customerDocType\": null, \"customerTelephoneNumber\": \"tryfbmrprlawccsnuvfycttpbedt\", \"bussinessName\": \"njjvkphaedjipgr\", \"fidelizationCard\": \"prqqrvmquiwlmgoiiyarkmvfvfolqe\"}, \"orderPriceInfo\": {\"clubAccumulated\": 0.8919467924610094, \"amount\": 0.24173559005263812, \"sellerName\": \"xwmlhgjsiaglrdocwfjlnshuhiowqxxdaerdppo\", \"sellerId\": \"gqnmuwhbb\", \"shippingAmount\": 0.7918888365012143, \"totalAmount\": 0.3807394787041839, \"amountNoDiscounts\": 0.09542646852993053, \"applicationId\": null, \"adjustments\": null}, \"siteId\": \"yujgbxii\", \"creationDate\": \"lkvnqbtumgvguqphtcrdgrtjtqlwuaavoibcum\", \"lastModifiedDate\": \"iq\", \"submittedDate\": \"ljnxuapx\", \"originOfOrder\": null, \"orderType\": \"yjjonbjswduvcfpvgsahmtbpcy\", \"logistic\": null, \"isNewPreparation\": null, \"isNewOrder\": null, \"migrated\": false, \"state\": \"ucphfyyqmcvqaibrydxnayxavkgulwephgxhg\", \"miraklId\": \"ispir\", \"miraklStatus\": null, \"omsOrderId\": \"bpxgavjaflrshccxxpwgxyvolqiwd\", \"isAnonymous\": false, \"parentOrderId\": \"jeooa\", \"salesmanId\": null, \"mallId\": null, \"billingStatus\": 1538899872, \"flatRate\": null, \"specialMark\": {\"category\": null, \"specialMarkType\": null, \"motive\": null}}"
  def processPipeline(kafkaAvroProducer: KafkaAvroProducer[Order], inputFileJson: Option[String])(implicit propertiesUtil: PropertiesUtil): Unit = {
    def processSend(kafkaAvroProducer: KafkaAvroProducer[Order], eventOrder: Order, topic: String): Unit = {
      kafkaAvroProducer.sendMessage(eventOrder)
      logInfo(s"***** ticket event sent to kafka (topic ${topic})")
      logInfo(s"[event]: $eventOrder")
    }

    val topicReservation = propertiesUtil.getReservationsTopic

    try {

      logInfo(s"schema registry: ${propertiesUtil.getSchemaRegistryURL}")
      if (inputFileJson.isEmpty) {
        logInfo("***** No json file given. Sending some default events to kafka")

        parser.decode[Order](defaultOrderJson) match {
          case Right(defaultOrderJsonBean) => processSend(kafkaAvroProducer, defaultOrderJsonBean, topicReservation)
          case Left(error) =>
            logWarn(error.getMessage)
            throw new Error(s"Wrong default json ${defaultOrderJson}")
        }

      } else {
        val jsonFile = Source.fromFile(inputFileJson.get)
        parser.decode[List[Order]](jsonFile.mkString) match {
          case Right(listOrderJsonBean) =>
            listOrderJsonBean.foreach(processSend(kafkaAvroProducer, _, topicReservation))
            logInfo(s"***** ${inputFileJson} sent to kafka (topic ${topicReservation})")
            jsonFile.close
          case Left(error) =>
            logWarn(error.getMessage)
            jsonFile.close
            throw new Error(s"Wrong input file JSON ${inputFileJson}")
        }

      }

    } finally {
      kafkaAvroProducer.close
    }
  }

  def main(args: Array[String]): Unit = {
    if (args.length < 4)
      throw new Error(s"Producer needs to be called with processFile.conf, application.conf, kafka_jaas.conf & user")

    val configPath = args(0)
    System.setProperty("java.security.auth.login.config", args(2))
    System.setProperty("config.file", configPath)

    implicit val propertiesUtil: PropertiesUtil = PropertiesUtil(args(3), args(1))
    processPipeline(new KafkaAvroProducer[Order], args.drop(4).headOption)
  }
}

class KafkaAvroProducer[E <: Events](_producer: Option[KafkaProducer[String, GenericRecord]] = None)(implicit propertiesUtil: PropertiesUtil)
  extends FunctionalLogger {

  private val topicReservation = propertiesUtil.getReservationsTopic
  private val schemaRegistryURL = propertiesUtil.getSchemaRegistryURL
  private val kafkaServers = propertiesUtil.getKafkaServers
  private val isKafkaSecured = propertiesUtil.isKafkaSecured
  private val avroSchema: Schema = getAvroSchema(schemaRegistryURL, topicReservation)
  implicit private val beanToRecordConverter: BeanToRecordConverter[E] = new BeanToRecordConverter[E](avroSchema)

  private val props = new Properties()
  props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaServers)
  props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, classOf[StringSerializer])
  props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, classOf[KafkaAvroSerializer])
  props.put(AbstractKafkaAvroSerDeConfig.SCHEMA_REGISTRY_URL_CONFIG, schemaRegistryURL)
  props.put(ProducerConfig.CLIENT_ID_CONFIG, UUID.randomUUID().toString)
  props.put(ProducerConfig.ACKS_CONFIG, "all")
  if (isKafkaSecured) {
    props.put(CommonClientConfigs.SECURITY_PROTOCOL_CONFIG, SecurityProtocol.SASL_PLAINTEXT.name)
    props.put(SaslConfigs.SASL_KERBEROS_SERVICE_NAME, "kafka")
  }

  private val producer = _producer.getOrElse(new KafkaProducer[String, GenericRecord](props))

  def sendMessage(eventRecord: E) {
    import com.training.bigdata.omnichannel.customerOrderReservation.events.avro.BeanToRecordConverterConversions._
    val queueMessage = new ProducerRecord[String, GenericRecord](topicReservation, Random.nextString(10), eventRecord)
    producer.send(queueMessage, new Callback{
      override def onCompletion(metadata: RecordMetadata, exception: Exception): Unit = {
        if(metadata != null) logInfo(s"metadata: ${metadata.toString}")
        else logNonFunctionalMessage(s"metadata is null, ex ${exception.toString}")
      }
    })
  }

  def sendMessage(avroRecord: GenericRecord) {
    val queueMessage = new ProducerRecord[String, GenericRecord](topicReservation, Random.nextString(10), avroRecord)
    producer.send(queueMessage, new Callback{
      override def onCompletion(metadata: RecordMetadata, exception: Exception): Unit = {
        if(metadata != null) logInfo(s"metadata: ${metadata.toString}")
        else logNonFunctionalMessage(s"metadata is null, ex ${exception.toString}")
      }
    })
  }

  def close(): Unit = {
    producer.flush()
    producer.close()
  }

}
